# 典型商用密码算法与应用

---

## 密码算法的基本概念

1. 《密码法》第二条：密码指采用特定变换的方法对信息等进行加密保护、安全认证的技术、产品和服务。

2. 在我国，密码分为普通密码、商用密码和核心密码。

   ​	其中，普密、核密用于保护国家秘密信息，核密保护信息的最高密级为绝密级。

3. 密码的四个特性

   **数据机密性、数据完整性、消息源真实性、不可否认性**

4. 密码技术经历了三大阶段：古典密码 -> 机械密码 -> 现代密码

5. 常见的密码算法：

   | 对称密码     | 公钥密码算法 | 密码杂凑算法 |
   | ------------ | ------------ | ------------ |
   | SM4 ZUC      | SM2 SM9      | SM3          |
   | DES 3DES AES | RSA          | MD5 SHA      |

## 密码算法安全强度

​	安全强度来表征攻破一个密码算法或系统所需的工作量，单位为bit

​	意义：一个算法安全强度为 x bit，则意味着它所需的计算量最多为2^x次

​	目前，**80 bit**安全强度的算法已经禁止使用，2023年后，**112 bit**安全强度也不再满足要求，会被禁止或限制使用。

## 对称密码算法

​	对称密码有主要两种形式：

   ​	·序列密码，如RC4、ZUC

   ​	·分组密码，如DES、AES、SM4 

## 对称密码算法——分组密码的工作模式

​	共有九种工作模式，分别为：

	1. ECB
	2. CBC
	3. CFB
	4. OFB
	5. CTR
	6. XTS
	7. HCTR
	8. BC
	9. OFBNLF

​	其中最为常用的是以下三种：

### 电码本(Electronic Code Book, ECB)模式

​	最简单的模式，针对每个分组分别实施加解密操作

​	**ECB的问题：**

	1. 同明同密，水印攻击
		1. 不能隐蔽数据模式，即相同的明文分组会产生相同的密文分组
	2. 通过操纵密文操作密文
		1. 对某一个分组的加密或解密可独立于其他分组进行
		2. 对密文分组的重排将导致明文分组的重拍
		3. 分组加密不能抵抗对分组的重放、嵌入和删除等攻击
	3. ***不推荐在应用中使用ECB模式***

### 密文分组链接(Cipher Block Chaining, CBC)模式

​	先与反馈至输入端的前一组密文分组按位异或，再送至加密模块进行加密。

​	**CBC的特点：**

	1. 链接操作使得密文分组依赖于当前的和以前的明文分组，因此对密文分组的重新编排不会导致对相应明文分组的重新编排。
	2.  从而导致**加大操纵明文的难度**，**抵抗水印攻击**。
	3.  在加密过程中可以使用IV（初始量）进行随机化，每次加密IV都必须重新生成，并且要保证IV的随机性，保证IV不可预测。

### 计数器(Counter, CTR)模式

​	CTR模式通过逐次累加的计数器值进行加密来生成密钥流。

​	**CTR的特点：**

	1. 支持加解密并行计算，可实现生成密钥流，进行加解密准备
	2. 只用到了分组密码算法的分组加密操作
	3. 错误密文中的对应比特只会影响解密后明文中的对应比特，即错误不会传播

## 对称密码算法——基于对称密码算法的MAC

​	**CBC-MAC的特点：**


 	1. CBC-MAC使用全0的IV进行CBC计算
 	2. 使用最后一个分组的输出结果作为MAC

​	**MAC附加在消息后，可以提供：**

```
数据完整性：对消息的任何恶意篡改都会被探测到
消息源真实性：只有拥有密钥的人才能生成对应MAC
```

## 对称密码算法——可鉴别的加密模式

​	研究人员将分组算法的两大功能加密和MAC合并，出了可鉴别的加密模式，可同时实现数据的**机密性、完整性以及对数据源真实性**的鉴别。

​	包括有CCM(Counter with CBC-MAC)和GCM(Galois/Counter Mode)等模式

## 公钥密码算法

​	与对称密码算法和杂凑算法（基于置换等手段进行混淆和扩散）不同，公钥密码的设计一般依赖于**计算困难的数学问题**。

​	主流使用的两大类：

```
1. 大整数分解问题：RSA
2. 离散对数问题：
   1. 有限域：DSA、ElGamal
   2. 椭圆曲线：ECDSA、SM2
```

​	后量子密码算法：

```
基于格的密码算法、基于编码的密码算法、基于哈希的密码算法、基于多变量的密码算法
```

## 公钥密码算法SM2

​	基点G公开，私钥d，公钥P=dG=（x，y）

```
我来解释一下，此处的私钥d是指G点运算d次，即GG d次
```

​	从P计算到私钥d，是个困难问题，计算上是不可行的

​	**重要特征：**

	1. 私钥256比特
	2. 公钥是一个点，由两个256比特的坐标表示

​	**算法标准：**

​	总则、数字签名、密钥协商、公钥加密、推荐参数 

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图1.png)

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图2.png)

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图3.png)

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图5.png)

  ## 密码杂凑函数

​	密码杂凑算法具有如下性质：

```
抗原像攻击（单向性）
抗第二原像攻击（弱抗碰撞性）
强抗碰撞攻击
```

​	SHA1、MD5已被碰撞出来了

## 密码杂凑函数——SM3算法

​	**关键特征：**分组长度512比特，输出256比特

## 密码杂凑函数——带密钥的密码杂凑函数HMAC

​	HMAC利用密码杂凑算法，将一个密钥和一个消息作为输入，生成一个消息摘要作为输出。HMAC计算时调用了两次完整的杂凑函数H，对于密钥K，消息D，计算公式如下：

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图4.png)

简单来说，将密钥和消息一起进行杂凑 

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图6.png)

 ![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图7.png)

## 密码算法实现的安全功能

### 机密性实现

​	机密性保护目的：避免信息泄露或暴露给未授权的实体

​	基本方法：

```
访问控制：防止敌手访问敏感信息
信息隐藏：避免敌手发现敏感信息存在
加密：使敌手无法从原始信息中提取有用信息
```

​	信息加密：

```
防止敌手从加密信息中提取到原始信息或有用的信息
```

​	信息加密需要考虑的因素：

```
密码体制选取：对称密码体制/公钥密码体制
密码算法选取：密码强度、性能、实现的代价、标准等方面考虑
工作模式选取：分组算法ECB/CBC/CFB/OFB/CTR模式等
明文加密前是否需要填充：如CTR/CFB/OFB等模式无需填充
初始化向量的需求
```

### 完整性实现

​	完整性保护目的：

```
保护信息免受非授权实体篡改或替代
```

​	信息完整性破坏：

```
修改：攻击者直接修改内容
删除：攻击者删除部分或全部内容
重排序：攻击者打乱数据顺序、然后发送
替换：攻击者用原来发过的数据、替换其中数据
```

​	数据完整性保护方法：

```
访问控制：限制非授权实体修改被保护数据
损坏-检测：无法避免数据损坏，但能确保损坏被检测出来
```

​	实现方法：

```
杂凑（不能防止恶意篡改）
MAC
数字签名
```

​	数据完整性的三个层次：

```
防范目标：无意的修改、传输错误（校验和）
防范目标：通信双方之外的、其他攻击者的有意修改（MAC）
防范目标：发送者之外的、包括接收者和其他攻击者的有意修改（数字签名）
```

### 真实性实现

​	真实性的目标：

```
保证已授权的实体才可以访问相关信息
关键问题：如何确定该实体是否有权限（核查实体的真实性）
```

​	常用身份鉴别方式：

```
基于密码技术
基于静态口令
基于动态口令
基于生物特征
```

	### 不可否认性实现

​	实体不可否认其曾经进行的操作，或当其想要否认时，中立方能够判定

​	现实中应用场景：

```
合同盖章：同意合同内容，留作证件，将来不能反悔（不可否认性），合同的骑缝章（完整性）
```

​	信息系统中应用场景：

```
电子合同：数字签名后，表示同意
```

​	起源的不可否认：

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图8.png)

​	传递的不可否认：

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图9.png)

![image-20231012144745150](C:\Users\offic\Documents\工作文档\笔记\密评笔记\典型商用密码算法与应用图10.png)



